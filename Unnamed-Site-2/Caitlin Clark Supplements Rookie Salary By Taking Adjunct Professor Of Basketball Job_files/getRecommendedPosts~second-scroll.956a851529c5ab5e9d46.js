(window.webpackJsonp=window.webpackJsonp||[]).push([["getRecommendedPosts~second-scroll"],{"+hmf":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractOptionalKey=t.extractOptionalIds=t.extractKey=t.extractIds=void 0;const o=(e,t)=>e.reduce(((e,s)=>s[t]?[...e,s[t]]:e),[]);t.extractOptionalKey=o;const n=(e,t)=>e.map((e=>e[t]));t.extractKey=n;t.extractOptionalIds=e=>o(e,"id");t.extractIds=e=>n(e,"id")},"G8+i":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;d(s("OAzy"));var o=d(s("XH+q")),n=s("WM6G");function d(e){return e&&e.__esModule?e:{default:e}}var a=({posts:e,blogs:t})=>Promise.all([(0,n.resolveCategorizationData)(e),(0,o.default)(e)]).then((([e,s])=>e.map((e=>e.clone({authors:s[e.id],defaultBlog:t.find((t=>t.id===e.defaultBlogId))})))));t.default=a,e.exports=t.default},IFmO:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRecommendedPostsUnresolved=t.getRecommendedPosts=t.getRecommendedPostIds=t.getRecommendedContentForVeritas=t.getRecommendedContentForContext=t.getRecommendedContentContext=t.extractMostRelevantPosts=t.combineLists=void 0;var o=m(s("tbV4")),n=m(s("bAmA")),d=m(s("Uj2Y")),a=s("//ky"),r=s("wxvn"),l=s("+hmf"),c=s("iUsr"),i=m(s("G8+i")),u=s("IqTx"),g=m(s("BZkQ")),f=s("OYmB");function m(e){return e&&e.__esModule?e:{default:e}}const p=e=>e.displayName,x=()=>{const{postMeta:e}=g.default.getCurrentPageContext();return e&&e.tags.length>0?{tags:e.tags.map(p)}:null};t.getRecommendedContentContext=x;const h=async({context:e,blogId:t,excludedPostIds:s=[],language:o=a.defaultLanguage,slideshowsOnly:n=!1,maxReturned:d,startIndex:l=0})=>(0,r.getRelatedStoriesByTags)({blogId:t,tags:e.tags,language:o,maxReturned:d,startIndex:l,excludedPostIds:s}).then(r.getPosts).then((e=>e.filter((e=>!n||e.isSlideshow))));t.getRecommendedContentForContext=h;const I=async({pi:e,blogId:t,excludedPostIds:s=[],language:o=a.defaultLanguage,slideshowsOnly:d=!1,maxReturned:l})=>{if(!e)return[];const c=await(0,r.getRecommendedContent)({pi:e,blogId:t,language:o,slideshowsOnly:d,maxReturned:l}).then((e=>e.map((e=>({...e,postIds:e.postIds.filter((e=>!(-1!==s.indexOf(e))))}))))).catch((()=>[])),i=(0,n.default)(c.reduce(((e,{postIds:t})=>[...e,...t]),[])),g=await(0,r.getPosts)(i);return c.map((({name:e,score:t,postIds:s})=>({name:e,score:t,posts:(0,u.resolveIds)(s,g)}))).filter((({posts:e})=>e.length>0))};t.getRecommendedContentForVeritas=I;const P=(e,t)=>{const s=e.reduce(((e,t)=>e+t.score),0),o=e.sort(((e,t)=>t.score-e.score));let n=t;const d=new Map(o.map((e=>{const o=Math.round(e.score/s*t);return n-=o,[e.name,o]})));return o.reduce(((e,t,s)=>{const o=0===s&&n>0?d.get(t.name)+n:d.get(t.name),a=t.posts.filter((t=>!e.some((e=>e.id===t.id)))).slice(0,o);return e.concat(...a)}),[])};t.extractMostRelevantPosts=P;const b=(e,t)=>{const s=[],o=Math.min(e.length,t.length);for(let n=0;n<o;n++)s.push(e[n]),s.push(t[n]);return[...s,...e.slice(o),...t.slice(o)]};t.combineLists=b;const v=async(e,t,s)=>((e,t,s)=>(0,d.default)([...e,...t],"id").slice(0,s))(e,e.length>=s?[]:await t(),s),y=async({blogId:e,excludedPostIds:t,language:s,slideshowsOnly:n,startIndex:i,maxReturned:u,pi:g,context:f})=>{const m=()=>(async({blogId:e,excludedPostIds:t=[],language:s=a.defaultLanguage,slideshowsOnly:o=!1,maxReturned:n})=>{if(o)return(await(0,r.getRecentSlideshowPosts)({blogIds:[e],language:s,maxReturned:n})).filter((e=>!(-1!==t.indexOf(e.id))));return(0,c.getPopularPostsForBlog)({blogId:e,language:s,maxReturned:n,excludedPosts:t})})({blogId:e,excludedPostIds:t,language:s,slideshowsOnly:n,maxReturned:u}),x=e=>v(e,m,u),y=()=>f?h({context:f,blogId:e,excludedPostIds:t,language:s,slideshowsOnly:n,startIndex:i,maxReturned:u}):Promise.resolve([]),R=await I({pi:g,blogId:e,excludedPostIds:t,language:s,slideshowsOnly:n,maxReturned:u});if(0===R.length&&f){const e=await y();return e.length>0?x(e).then((e=>({posts:e,source:"context"}))):x([]).then((e=>({posts:e,source:"fallback"})))}if(f){const e=R.map((e=>({...e,posts:e.posts.filter((e=>((e,t)=>(0,o.default)(e.tags.map(p),t.tags).length>0)(e,f)))}))).filter((({posts:e})=>e.length>0)),t=P(e,u);if(t.length>=u)return x(t).then((e=>({posts:e,source:"veritas"})));const s=(0,l.extractIds)(t),n=R.reduce(((e,{posts:t})=>[...e,...t.filter((e=>!(-1!==s.indexOf(e.id))))]),[]),a=await y(),r=b(a,n);return x((0,d.default)([...t,...r],"id")).then((e=>({posts:e,source:"veritas"})))}const w=R.reduce(((e,{posts:t})=>[...e,...t]),[]);return x(w).then((e=>({posts:e,source:w.length>0?"veritas":"fallback"})))};t.getRecommendedPostsUnresolved=y;t.getRecommendedPosts=({blog:e,...t})=>{const s=x();return y({blogId:e.id,...t,pi:(0,f.getVeritasId)(),context:s}).then((({posts:t})=>(0,i.default)({posts:t,blogs:[e]})))};t.getRecommendedPostIds=e=>{const t=x();return y({...e,pi:(0,f.getVeritasId)(),context:t}).then((({posts:e})=>(0,l.extractIds)(e)))}},IqTx:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveKeys=t.resolveIds=void 0;const o=(e,t,s)=>e.reduce(((e,o)=>{const n=t.find((e=>e[s]===o));return n?e.concat(n):e}),[]);t.resolveKeys=o;t.resolveIds=(e,t)=>o(e,t,"id")},WM6G:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveCategorizationData=void 0;var o,n=s("Dem5"),d=(o=s("bAmA"))&&o.__esModule?o:{default:o};t.resolveCategorizationData=e=>{const t=(0,d.default)(e.reduce(((e,t)=>(t.categorization&&t.categorization.channelId&&e.push(t.categorization.channelId),e)),[])),s=(0,d.default)(e.reduce(((e,t)=>(t.categorization&&t.categorization.sectionId&&e.push(t.categorization.sectionId),t.categorization&&t.categorization.subsectionId&&e.push(t.categorization.subsectionId),e)),[]));return Promise.all([(0,n.getChannelsByIds)(t),(0,n.getSectionsByIds)(s)]).then((([t,s])=>e.map((e=>{const{channelId:o,sectionId:n,subsectionId:d}=e.categorization||{},a=o?{channel:t.find((e=>e.id===o)),...n?{section:s.find((e=>e.id===n))}:{},...d?{subsection:s.find((e=>e.id===d))}:{}}:null;return e.clone({categorizationData:a})}))))}},arsC:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function({blog:e,maxReturned:t=12,excludedPosts:s=[]}){const o=`${e}-${t}`,i=await u.get(o);if(i&&Array.isArray(i))return i;const g=(await(0,d.getRecentVideoPostsForBlogs)([e],t)).filter((e=>-1===s.indexOf(e.id))).filter((e=>(0,r.filterForRecirc)(e))),f=(0,c.default)(g).catch((()=>({}))),m=(0,l.default)(g).catch((()=>({})));return(0,a.default)({blogs:f,authors:m}).then((({blogs:e,authors:t})=>{const s=g.reduce(((s,o)=>{const d=e[o.defaultBlogId];if(!d)throw new Error("Missing defaultBlog in Blog lookup in getRecentVideosForBlogs");const a=n.default.fromPost(o,d,t[o.id]);return s.concat([a])}),[]);return u.set(o,s),s}))};var o=i(s("Vemv")),n=i(s("HGHY")),d=(i(s("OiCc")),s("wxvn")),a=i(s("ehbF")),r=s("2m1d"),l=i(s("XH+q")),c=i(s("SoMj"));function i(e){return e&&e.__esModule?e:{default:e}}const u=new o.default({model:n.default,name:"recentVideosForBlog"});e.exports=t.default},iUsr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({currentBlog:e,language:t,excludedPosts:s=[]}){let o;o=e.isSatire?(0,a.default)({blog:e.id,excludedPosts:s}):(0,d.getPopularSidebarPostsForBlog)({blogId:e.id,language:t,excludedPosts:s});return o.then((e=>e.slice(0,3)))},t.getPopularPostsForBlog=void 0,t.getPostIdsFromCuration=function(e){if(!e||!e.items)return[];return e.items.reduce(((e,t)=>(t.id&&e.push(t.id),e)),[])};r(s("OAzy"));var o=s("wxvn"),n=s("vGmL"),d=s("yOsc"),a=r(s("arsC"));function r(e){return e&&e.__esModule?e:{default:e}}t.getPopularPostsForBlog=async({blogId:e,language:t,excludedPosts:s,window:d=12,maxReturned:a=4})=>(0,n.trendingPosts)({blogIds:[e],language:t,past:`${d} minutes`,exclude:s,maxReturned:a}).then((e=>(0,o.getPosts)(e.map((e=>e.id))))).catch((()=>[]))}}]);